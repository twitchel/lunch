{% extends "NinjaLunchBundle::layout.base.twig" %}
{% from 'MopaBootstrapBundle::icons.html.twig' import icon %}
{% block headline %}
Viewing order for {{ entity.date | date('Y-m-d') }}
{% endblock %}
{% block content %}
{% set orderCount = entity.items | length %}
{% set itemLabelClass = orderCount == 10 ? 'success' : orderCount >= 6 ? 'info' : orderCount >= 3 ? 'warning' : 'important' %}
{% set participants = entity.participants %}
<div class="row-fluid">
    <div class="span4">
        <div class="btn-group">
            <a href="{{ path('orders') }}" class="btn">
                {{ icon('arrow-left') }} Back to the list
            </a>
            {% if entity.locked %}
            <span class="btn disabled">
                {{ icon('lock') }} Placed
            </span>
            {% else %}
            <a href="{{ path('orders_lock', {id : entity.id}) }}" class="btn">
                {{ icon('lock') }} Place Order
            </a>
            {% endif %}
        </div>
    </div>
    <div class="span8">
        <ul class="nav nav-tabs" id="order-item-tabs">
            <li class="active"><a data-toggle="tab" href="#view-items">View Items</a></li>
            <li><a data-toggle="tab" href="#add-item">Add Item</a></li>
            <li><a data-toggle="tab" href="#view-report">Order Report</a></li>
        </ul>
    </div>
<div class="row-fluid">
    <div class="span4">
        <h2>Item Details</h2>
        <table class="record_properties table table-hover table-bordered">
            <tbody>
                <tr>
                    <th>Id</th>
                    <td>{{ entity.id }}</td>
                </tr>
                <tr>
                    <th>Date</th>
                    <td>{{ entity.date|date('Y-m-d H:i:s') }}</td>
                </tr>
                <tr>
                    <th>Items</th>
                    <td><span class="label {{ itemLabelClass }}">{{ entity.items | length }}</span></td>
                </tr>
                <tr>
                    <th>Participants</th>
                    <td>
                        {% for participant in participants %}
                            <a href="{{ path('user_profile', { username: app.user.username }) }}">
                                {{ participant }}{% if loop.last == false %}, {% endif %}
                            </a>
                        {% endfor %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="span8">
        <div class="tab-content">
            <div class="tab-pane active" id="view-items">
                <h2>List Order Items</h2>
                <div class="list-item-wrap">
                    {% render "NinjaLunchBundle:FoodOrder/Item:list" with { order: entity.id }, { standalone: true } %}
                </div>
            </div>
            <div class="tab-pane" id="add-item">
                <h2>Add Item</h2>
                <div class="add-item-wrap">
                    {% render "NinjaLunchBundle:FoodOrder/Item:form" with { order: entity.id }, { standalone: true } %}
                </div>
            </div>
            <div class="tab-pane" id="view-report">
                <h2>View Report</h2>
                <div class="view-report-wrap">
                    {% render "NinjaLunchBundle:FoodOrder/Item:report" with { order: entity.id }, { standalone: true } %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
